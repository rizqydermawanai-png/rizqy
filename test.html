<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PT. Gudang Abadi</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background-color: #333; color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { margin: 0; font-size: 24px; }
        .header .user-info { display: flex; align-items: center; }
        .header .user-info span { margin-right: 15px; }
        .header .user-info button { background-color: #f44336; color: white; border: none; padding: 8px 12px; cursor: pointer; border-radius: 4px; }
        .header .user-info button:hover { background-color: #d32f2f; }
        .tabs { display: flex; background-color: #444; }
        .tab-button { background-color: #444; color: white; border: none; padding: 14px 20px; cursor: pointer; font-size: 16px; transition: background-color 0.3s; }
        .tab-button.active, .tab-button:hover { background-color: #555; }
        .tab-content { display: none; padding: 20px; border: 1px solid #ddd; background-color: white; border-top: none; }
        .tab-content.active { display: block; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        table, th, td { border: 1px solid #ddd; }
        th, td { padding: 12px; text-align: left; }
        th { background-color: #f2f2f2; }
        .button { background-color: #4CAF50; color: white; padding: 10px 15px; border: none; cursor: pointer; border-radius: 4px; font-size: 14px; }
        .button:hover { background-color: #45a049; }
        .button.export { background-color: #008CBA; }
        .button.export:hover { background-color: #007B9A; }
        .form-container { background-color: #f9f9f9; padding: 20px; border-radius: 5px; margin-top: 20px; }
        .form-container h3 { margin-top: 0; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; }
        .form-group input, .form-group select { width: 100%; padding: 8px; box-sizing: border-box; }
        .hidden { display: none; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

    <div id="login-page">
        <div class="container">
            <h2>Login</h2>
            <div class="form-container">
                <div class="form-group">
                    <label for="username">Username:</label>
                    <input type="text" id="username" name="username">
                </div>
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" name="password">
                </div>
                <button class="button" onclick="login()">Login</button>
            </div>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <div class="header">
            <h1>PT. Gudang Abadi</h1>
            <div class="user-info">
                <span id="user-display"></span>
                <button onclick="logout()">Logout</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="openTab(event, 'Recapitulation')">Rekapitulasi</button>
            <button class="tab-button" onclick="openTab(event, 'StockHistory')">Riwayat Stok</button>
            <button class="tab-button" id="message-board-tab" onclick="openTab(event, 'MessageBoard')">Papan Pesan</button>
            <button class="tab-button" id="my-profile-tab" onclick="openTab(event, 'MyProfile')">Profil Saya</button>
            <button class="tab-button hidden" id="user-management-tab" onclick="openTab(event, 'UserManagement')">Manajemen Pengguna</button>
        </div>

        <!-- Recapitulation Tab -->
        <div id="Recapitulation" class="tab-content active">
            <h2>Rekapitulasi Kinerja</h2>
            <button class="button export" onclick="exportRecapitulationToExcel()">Export to Excel</button>

            <h3>Key Performance Indicator (KPI)</h3>
            <table id="kpi-table">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>KPI</th>
                        <th>Target</th>
                        <th>Actual</th>
                        <th>Percentage</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>1</td><td>Sales Target</td><td>Rp 1.000.000.000</td><td>Rp 1.200.000.000</td><td>120%</td></tr>
                    <tr><td>2</td><td>Production Output</td><td>500.000 unit</td><td>480.000 unit</td><td>96%</td></tr>
                     <tr><td>3</td><td>On-time Delivery</td><td>95%</td><td>97%</td><td>102%</td></tr>
                </tbody>
            </table>

            <h3>Penjualan</h3>
            <table id="sales-table">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Product</th>
                        <th>Region</th>
                        <th>Sales Volume</th>
                        <th>Revenue</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>1</td><td>Produk A</td><td>Jakarta</td><td>150.000 unit</td><td>Rp 450.000.000</td></tr>
                    <tr><td>2</td><td>Produk B</td><td>Surabaya</td><td>100.000 unit</td><td>Rp 300.000.000</td></tr>
                    <tr><td>3</td><td>Produk A</td><td>Bandung</td><td>80.000 unit</td><td>Rp 240.000.000</td></tr>
                </tbody>
            </table>

            <h3>Produksi</h3>
            <table id="production-table">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Production Line</th>
                        <th>Product</th>
                        <th>Output</th>
                        <th>Efficiency</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>1</td><td>Line 1</td><td>Produk A</td><td>300.000 unit</td><td>98%</td></tr>
                    <tr><td>2</td><td>Line 2</td><td>Produk B</td><td>180.000 unit</td><td>95%</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Stock History Tab -->
        <div id="StockHistory" class="tab-content">
            <h2>Riwayat Stok</h2>
            <button class="button export" onclick="exportStockHistoryToExcel()">Export to Excel</button>
            <div id="stock-history-content"></div>
        </div>

        <!-- Message Board Tab -->
        <div id="MessageBoard" class="tab-content">
            <h2>Papan Pesan</h2>
            <div class="form-container">
                <h3>Kirim Pesan Baru</h3>
                <div class="form-group">
                    <label for="message-recipient">Penerima:</label>
                    <select id="message-recipient">
                        <option value="all">Semua Pengguna</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="message-text">Pesan:</label>
                    <textarea id="message-text" rows="4" style="width: 100%;"></textarea>
                </div>
                <button class="button" onclick="sendMessage()">Kirim</button>
            </div>
            <div id="message-board-content" style="margin-top: 20px;">
                <h3>Pesan Diterima</h3>
                <ul id="message-list"></ul>
            </div>
        </div>

        <!-- My Profile Tab -->
        <div id="MyProfile" class="tab-content">
            <h2>Profil Saya</h2>
            <div class="form-container">
                <p><strong>Username:</strong> <span id="profile-username"></span></p>
                <p><strong>Role:</strong> <span id="profile-role"></span></p>
                <div class="form-group">
                    <label for="current-password">Password Saat Ini:</label>
                    <input type="password" id="current-password">
                </div>
                <div class="form-group">
                    <label for="new-password">Password Baru:</label>
                    <input type="password" id="new-password">
                </div>
                <button class="button" onclick="changePassword()">Ubah Password</button>
            </div>
        </div>

        <!-- User Management Tab -->
        <div id="UserManagement" class="tab-content">
            <h2>Manajemen Pengguna</h2>
            <div class="form-container">
                <h3>Tambah Pengguna Baru</h3>
                <div class="form-group">
                    <label for="new-username">Username:</label>
                    <input type="text" id="new-username">
                </div>
                <div class="form-group">
                    <label for="new-user-password">Password:</label>
                    <input type="text" id="new-user-password">
                </div>
                <div class="form-group">
                    <label for="new-user-role">Role:</label>
                    <select id="new-user-role">
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                        <option value="super_admin">Super Admin</option>
                    </select>
                </div>
                <button class="button" onclick="addUser()">Tambah Pengguna</button>
            </div>
            <h3>Daftar Pengguna</h3>
            <table id="user-management-table">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Role</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

    </div>

    <script>
        // Dummy user data
        let users = {
            "super_admin": { password: "password123", role: "super_admin", messages: [] },
            "admin": { password: "password123", role: "admin", messages: [] },
            "user": { password: "password123", role: "user", messages: [] }
        };

        let loggedInUser = null;

        // Dummy stock data
        const stockData = {
            incoming: [
                { no: 1, date: '2023-10-01', item: 'Bahan Baku A', qty: 1000, supplier: 'Pemasok X' },
                { no: 2, date: '2023-10-02', item: 'Bahan Baku B', qty: 500, supplier: 'Pemasok Y' }
            ],
            outgoing: [
                { no: 1, date: '2023-10-03', item: 'Produk Jadi A', qty: 200, destination: 'Distributor Z' },
                { no: 2, date: '2023-10-04', item: 'Produk Jadi B', qty: 150, destination: 'Distributor W' }
            ]
        };

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            if (users[username] && users[username].password === password) {
                loggedInUser = username;
                document.getElementById('login-page').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                document.getElementById('user-display').innerText = `Welcome, ${username} (${users[username].role})`;
                setupUI();
            } else {
                alert('Invalid username or password');
            }
        }

        function logout() {
            loggedInUser = null;
            document.getElementById('login-page').classList.remove('hidden');
            document.getElementById('main-app').classList.add('hidden');
        }

        function setupUI() {
            const userRole = users[loggedInUser].role;
            if (userRole === 'super_admin') {
                document.getElementById('user-management-tab').classList.remove('hidden');
                renderUserManagement();
            } else {
                 document.getElementById('user-management-tab').classList.add('hidden');
            }
            renderStockHistory();
            renderMessageBoard();
            renderMyProfile();
            updateMessageRecipients();
        }

        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tab-button");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        function renderStockHistory() {
            const contentDiv = document.getElementById('stock-history-content');
            let html = '<h3>Rekap Stok Masuk</h3>';
            html += '<table id="incoming-stock-table"><thead><tr>';
            Object.keys(stockData.incoming[0]).forEach(key => html += `<th>${key.charAt(0).toUpperCase() + key.slice(1)}</th>`);
            html += '</tr></thead><tbody>';
            stockData.incoming.forEach(row => {
                html += '<tr>';
                Object.values(row).forEach(val => html += `<td>${val}</td>`);
                html += '</tr>';
            });
            html += '</tbody></table>';

            html += '<h3 style="margin-top: 30px;">Rekap Stok Keluar</h3>';
            html += '<table id="outgoing-stock-table"><thead><tr>';
            Object.keys(stockData.outgoing[0]).forEach(key => html += `<th>${key.charAt(0).toUpperCase() + key.slice(1)}</th>`);
            html += '</tr></thead><tbody>';
            stockData.outgoing.forEach(row => {
                html += '<tr>';
                Object.values(row).forEach(val => html += `<td>${val}</td>`);
                html += '</tr>';
            });
            html += '</tbody></table>';
            contentDiv.innerHTML = html;
        }

        function renderUserManagement() {
            const tableBody = document.querySelector('#user-management-table tbody');
            tableBody.innerHTML = '';
            for (const username in users) {
                if (username !== loggedInUser) { // Super admin can't delete themselves
                    let row = `<tr>
                        <td>${username}</td>
                        <td>${users[username].role}</td>
                        <td><button class="button" onclick="deleteUser('${username}')">Hapus</button></td>
                    </tr>`;
                    tableBody.innerHTML += row;
                }
            }
        }

        function addUser() {
            const username = document.getElementById('new-username').value;
            const password = document.getElementById('new-user-password').value;
            const role = document.getElementById('new-user-role').value;
            if (username && password && !users[username]) {
                users[username] = { password, role, messages: [] };
                renderUserManagement();
                updateMessageRecipients();
                alert('Pengguna berhasil ditambahkan!');
            } else {
                alert('Username sudah ada atau input tidak valid.');
            }
        }

        function deleteUser(username) {
            if (confirm(`Apakah Anda yakin ingin menghapus pengguna ${username}?`)) {
                delete users[username];
                renderUserManagement();
                updateMessageRecipients();
                alert('Pengguna berhasil dihapus.');
            }
        }

        function renderMyProfile() {
            document.getElementById('profile-username').innerText = loggedInUser;
            document.getElementById('profile-role').innerText = users[loggedInUser].role;
        }

        function changePassword() {
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            if (users[loggedInUser].password === currentPassword) {
                if (newPassword) {
                    users[loggedInUser].password = newPassword;
                    alert('Password berhasil diubah.');
                    document.getElementById('current-password').value = '';
                    document.getElementById('new-password').value = '';
                } else {
                    alert('Password baru tidak boleh kosong.');
                }
            } else {
                alert('Password saat ini salah.');
            }
        }

        function updateMessageRecipients() {
            const recipientSelect = document.getElementById('message-recipient');
            recipientSelect.innerHTML = '<option value="all">Semua Pengguna</option>';
            for (const username in users) {
                if (username !== loggedInUser) {
                    recipientSelect.innerHTML += `<option value="${username}">${username}</option>`;
                }
            }
        }

        function sendMessage() {
            const recipient = document.getElementById('message-recipient').value;
            const message = document.getElementById('message-text').value;
            if (!message) {
                alert('Pesan tidak boleh kosong.');
                return;
            }

            const messageObj = {
                sender: loggedInUser,
                text: message,
                timestamp: new Date().toLocaleString()
            };

            if (recipient === 'all') {
                for (const username in users) {
                    if (username !== loggedInUser) {
                        users[username].messages.push(messageObj);
                    }
                }
            } else {
                if (users[recipient]) {
                    users[recipient].messages.push(messageObj);
                }
            }
            alert('Pesan terkirim!');
            document.getElementById('message-text').value = '';
        }

        function renderMessageBoard() {
            const messageList = document.getElementById('message-list');
            messageList.innerHTML = '';
            const userMessages = users[loggedInUser].messages;
            if (userMessages.length === 0) {
                messageList.innerHTML = '<li>Tidak ada pesan baru.</li>';
            } else {
                userMessages.forEach(msg => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `<strong>Dari: ${msg.sender}</strong> (${msg.timestamp})<br>${msg.text}`;
                    messageList.appendChild(listItem);
                });
            }
        }

        function tableToSheet(tableId) {
            const table = document.getElementById(tableId);
            const sheet = XLSX.utils.table_to_sheet(table);
            return sheet;
        }

        function exportRecapitulationToExcel() {
            if (users[loggedInUser].role !== 'super_admin') {
                alert('Hanya super admin yang dapat mengekspor data ini.');
                return;
            }

            const wb = XLSX.utils.book_new();

            const kpiSheet = tableToSheet('kpi-table');
            XLSX.utils.book_append_sheet(wb, kpiSheet, 'KPI');

            const salesSheet = tableToSheet('sales-table');
            XLSX.utils.book_append_sheet(wb, salesSheet, 'Penjualan');

            const productionSheet = tableToSheet('production-table');
            XLSX.utils.book_append_sheet(wb, productionSheet, 'Produksi');

            XLSX.writeFile(wb, 'Rekapitulasi_Kinerja.xlsx');
        }

        function exportStockHistoryToExcel() {
            if (users[loggedInUser].role !== 'super_admin') {
                alert('Hanya super admin yang dapat mengekspor data ini.');
                return;
            }

            const wb = XLSX.utils.book_new();

            const incomingSheet = tableToSheet('incoming-stock-table');
            XLSX.utils.book_append_sheet(wb, incomingSheet, 'Stok Masuk');

            const outgoingSheet = tableToSheet('outgoing-stock-table');
            XLSX.utils.book_append_sheet(wb, outgoingSheet, 'Stok Keluar');

            XLSX.writeFile(wb, 'Riwayat_Stok.xlsx');
        }


        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
             // Default to login page
        });

    </script>
</body>
</html>
